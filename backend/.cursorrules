# Bot Factory - Backend Cursor Rules (Django)

## üìã –û–±–∑–æ—Ä –ü—Ä–æ–µ–∫—Ç–∞

Bot Factory ‚Äî SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI-–±–æ—Ç–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Telegram –∏ Google Gemini.
Backend –Ω–∞ Django REST Framework, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π REST API –¥–ª—è frontend (React/TypeScript).
–ú–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `backend/` (Django) + `frontend/` (React).

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫ Backend

### Framework & Core
- **Framework:** Django 5.0+ (LTS)
- **API Framework:** Django REST Framework (DRF) 3.15+
- **Database:** PostgreSQL 15+
- **Python Version:** 3.11+ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ñ–∏—á–∏)

### –û—Å–Ω–æ–≤–Ω—ã–µ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **DRF:** REST API, serializers, viewsets, permissions
- **djangorestframework-simplejwt:** JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **psycopg2-binary:** PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- **python-dotenv:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **celery:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- **redis:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Celery broker (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

### AI & Integrations
- **google-generativeai:** Google Gemini API integration
- **python-telegram-bot:** Telegram Bot API wrapper
- **requests:** HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API

### Utilities & Testing
- **pytest-django:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **black:** –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **flake8 / ruff:** –õ–∏–Ω—Ç–∏–Ω–≥
- **mypy:** Type checking (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **factory-boy:** –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

---

## üìÅ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ bot_factory/              # –ì–ª–∞–≤–Ω—ã–π Django –ø—Ä–æ–µ–∫—Ç
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ development.py   # Dev –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ production.py    # Prod –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ urls.py              # Root URLconf
‚îÇ   ‚îú‚îÄ‚îÄ wsgi.py
‚îÇ   ‚îî‚îÄ‚îÄ asgi.py              # –î–ª—è WebSocket (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ apps/                     # Django –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ accounts/            # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permissions.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ bots/                # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services.py      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ knowledge/           # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ snippets)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ chat/                # –ß–∞—Ç-—Å–µ—Å—Å–∏–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ analytics/           # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ services.py
‚îÇ   ‚îî‚îÄ‚îÄ telegram/            # Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ models.py
‚îÇ       ‚îú‚îÄ‚îÄ services.py      # Telegram bot handlers
‚îÇ       ‚îú‚îÄ‚îÄ views.py         # Webhook endpoints
‚îÇ       ‚îî‚îÄ‚îÄ urls.py
‚îú‚îÄ‚îÄ core/                     # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ permissions.py       # –ö–∞—Å—Ç–æ–º–Ω—ã–µ permissions
‚îÇ   ‚îú‚îÄ‚îÄ mixins.py            # Reusable mixins
‚îÇ   ‚îú‚îÄ‚îÄ pagination.py        # –ö–∞—Å—Ç–æ–º–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py        # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ utils.py             # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ services/                # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ gemini.py            # Google Gemini integration
‚îÇ   ‚îú‚îÄ‚îÄ telegram.py          # Telegram bot service
‚îÇ   ‚îî‚îÄ‚îÄ ai_base.py           # –ë–∞–∑–æ–≤—ã–π AI service
‚îú‚îÄ‚îÄ tests/                    # –û–±—â–∏–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ requirements/
‚îÇ   ‚îú‚îÄ‚îÄ base.txt
‚îÇ   ‚îú‚îÄ‚îÄ development.txt
‚îÇ   ‚îî‚îÄ‚îÄ production.txt
‚îú‚îÄ‚îÄ manage.py
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

---

## üèóÔ∏è –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ö–æ–¥–∞ Django

### 1. Models (models.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç `models.Model`
- –ò—Å–ø–æ–ª—å–∑—É–π `django.utils.timezone.now` –¥–ª—è –¥–∞—Ç
- –î–æ–±–∞–≤–ª—è–π `__str__` –∏ `__repr__` –º–µ—Ç–æ–¥—ã
- –ò—Å–ø–æ–ª—å–∑—É–π `Meta` –∫–ª–∞—Å—Å –¥–ª—è `verbose_name`, `ordering`, `indexes`
- UUID –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π –≤ API –º–æ–¥–µ–ª—è—Ö (–ø–æ –∂–µ–ª–∞–Ω–∏—é)
- –ò—Å–ø–æ–ª—å–∑—É–π `related_name` –¥–ª—è reverse relations

**–ü—Ä–∏–º–µ—Ä:**
```python
from django.db import models
from django.utils import timezone
import uuid

class Bot(models.Model):
    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
    owner = models.ForeignKey(
        'accounts.User',
        on_delete=models.CASCADE,
        related_name='bots'
    )
    name = models.CharField(max_length=100)
    description = models.TextField(blank=True)
    status = models.CharField(
        max_length=20,
        choices=[
            ('draft', 'Draft'),
            ('active', 'Active'),
            ('paused', 'Paused'),
            ('error', 'Error'),
        ],
        default='draft'
    )
    model = models.CharField(max_length=100)  # gemini-2.5-flash, gpt-4, etc.
    provider = models.CharField(
        max_length=20,
        choices=[('gemini', 'Gemini'), ('openai', 'OpenAI'), ('anthropic', 'Anthropic')],
        default='gemini'
    )
    temperature = models.FloatField(default=0.7)
    system_instruction = models.TextField(blank=True)
    thinking_budget = models.IntegerField(null=True, blank=True)  # For Gemini thinking models
    telegram_token = models.CharField(max_length=200, blank=True)
    avatar = models.CharField(max_length=200, blank=True)  # Emoji or URL
    created_at = models.DateTimeField(default=timezone.now)
    updated_at = models.DateTimeField(auto_now=True)

    class Meta:
        verbose_name = 'Bot'
        verbose_name_plural = 'Bots'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['owner', 'status']),
            models.Index(fields=['created_at']),
        ]

    def __str__(self):
        return f"{self.name} ({self.owner.email})"

    @property
    def conversations_count(self):
        return self.chat_sessions.count()

    @property
    def documents_count(self):
        return self.documents.count()
```

### 2. Serializers (serializers.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–π `ModelSerializer` –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤
- –°–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–µ `CreateSerializer` –∏ `UpdateSerializer` –µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –º–µ—Ç–æ–¥–∞—Ö `validate_<field>` –∏–ª–∏ `validate()`
- –ò—Å–ø–æ–ª—å–∑—É–π `SerializerMethodField` –¥–ª—è computed –ø–æ–ª–µ–π
- –í–ª–æ–∂–µ–Ω–Ω—ã–µ serializers –¥–ª—è related objects

**–ü—Ä–∏–º–µ—Ä:**
```python
from rest_framework import serializers
from apps.bots.models import Bot

class BotSerializer(serializers.ModelSerializer):
    conversations_count = serializers.IntegerField(read_only=True)
    documents_count = serializers.IntegerField(read_only=True)
    owner_email = serializers.EmailField(source='owner.email', read_only=True)

    class Meta:
        model = Bot
        fields = [
            'id', 'name', 'description', 'status', 'model', 'provider',
            'temperature', 'system_instruction', 'thinking_budget',
            'telegram_token', 'avatar', 'created_at', 'updated_at',
            'conversations_count', 'documents_count', 'owner_email'
        ]
        read_only_fields = ['id', 'created_at', 'updated_at', 'owner']

    def validate_temperature(self, value):
        if not 0 <= value <= 2:
            raise serializers.ValidationError("Temperature must be between 0 and 2")
        return value

    def validate_thinking_budget(self, value):
        if value is not None and value < 0:
            raise serializers.ValidationError("Thinking budget must be non-negative")
        return value

class BotCreateSerializer(BotSerializer):
    """Serializer for creating bots - owner is set automatically"""
    pass

class BotUpdateSerializer(BotSerializer):
    """Serializer for updating bots - some fields may be readonly"""
    pass
```

### 3. Views / ViewSets (views.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–π `ViewSet` –∏–ª–∏ `ModelViewSet` –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ actions —á–µ—Ä–µ–∑ `@action(detail=True/False)`
- –ò—Å–ø–æ–ª—å–∑—É–π `get_queryset()` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ user
- –ò—Å–ø–æ–ª—å–∑—É–π `get_serializer_class()` –¥–ª—è —Ä–∞–∑–Ω—ã—Ö serializers (create/update)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ exceptions

**–ü—Ä–∏–º–µ—Ä:**
```python
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticated
from django.shortcuts import get_object_or_404

from apps.bots.models import Bot
from apps.bots.serializers import BotSerializer, BotCreateSerializer, BotUpdateSerializer
from core.permissions import IsOwnerOrReadOnly

class BotViewSet(viewsets.ModelViewSet):
    """
    ViewSet –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞–º–∏.
    
    list: –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    create: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞
    retrieve: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –±–æ—Ç–∞
    update: –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞
    partial_update: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞
    destroy: –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞
    """
    permission_classes = [IsAuthenticated, IsOwnerOrReadOnly]
    
    def get_queryset(self):
        """–§–∏–ª—å—Ç—Ä—É–µ–º –±–æ—Ç—ã –ø–æ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        return Bot.objects.filter(owner=self.request.user)
    
    def get_serializer_class(self):
        """–ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–Ω—ã–µ serializers –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π"""
        if self.action == 'create':
            return BotCreateSerializer
        elif self.action in ['update', 'partial_update']:
            return BotUpdateSerializer
        return BotSerializer
    
    def perform_create(self, serializer):
        """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º owner –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏"""
        serializer.save(owner=self.request.user)
    
    @action(detail=True, methods=['post'])
    def activate(self, request, pk=None):
        """–ö–∞—Å—Ç–æ–º–Ω–æ–µ action –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –±–æ—Ç–∞"""
        bot = self.get_object()
        if bot.status == 'draft':
            bot.status = 'active'
            bot.save()
            return Response({'status': 'activated'})
        return Response(
            {'error': 'Bot is not in draft status'},
            status=status.HTTP_400_BAD_REQUEST
        )
```

### 4. Services (services.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –í—ã–Ω–æ—Å–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ views –≤ services
- Services ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω—ã–µ Python –∫–ª–∞—Å—Å—ã –∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏
- –û–¥–∏–Ω service –∫–ª–∞—Å—Å –Ω–∞ –¥–æ–º–µ–Ω (BotService, GeminiService, TelegramService)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ services

**–ü—Ä–∏–º–µ—Ä:**
```python
from typing import Optional
from apps.bots.models import Bot
from apps.accounts.models import User
from services.gemini import GeminiService

class BotService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–∞–º–∏"""
    
    def __init__(self):
        self.gemini_service = GeminiService()
    
    def create_bot(self, owner: User, data: dict) -> Bot:
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞"""
        bot = Bot.objects.create(owner=owner, **data)
        # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞ –∏ —Ç.–¥.)
        return bot
    
    def update_bot(self, bot: Bot, data: dict) -> Bot:
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞"""
        for key, value in data.items():
            setattr(bot, key, value)
        bot.save()
        return bot
    
    def delete_bot(self, bot: Bot) -> None:
        """–£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞ —Å –æ—á–∏—Å—Ç–∫–æ–π —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
        # –û—á–∏—Å—Ç–∫–∞ Telegram –±–æ—Ç–∞, –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ç.–¥.
        bot.delete()
    
    def test_bot_response(self, bot: Bot, prompt: str) -> str:
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞"""
        response = self.gemini_service.generate_response(
            model=bot.model,
            prompt=prompt,
            system_instruction=bot.system_instruction,
            temperature=bot.temperature,
            thinking_budget=bot.thinking_budget
        )
        return response
```

### 5. Permissions (permissions.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –°–æ–∑–¥–∞–≤–∞–π –∫–∞—Å—Ç–æ–º–Ω—ã–µ permissions –≤ `core/permissions.py`
- –ò—Å–ø–æ–ª—å–∑—É–π –±–∞–∑–æ–≤—ã–µ DRF permissions –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–π ownership —á–µ—Ä–µ–∑ `obj.owner == request.user`

**–ü—Ä–∏–º–µ—Ä:**
```python
from rest_framework import permissions

class IsOwnerOrReadOnly(permissions.BasePermission):
    """
    –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ,
    –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å.
    """
    
    def has_object_permission(self, request, view, obj):
        # Read permissions –¥–ª—è –≤—Å–µ—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
        if request.method in permissions.SAFE_METHODS:
            return request.user.is_authenticated
        
        # Write permissions —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
        return obj.owner == request.user

class IsBotOwner(permissions.BasePermission):
    """–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–æ—Ç–∞"""
    
    def has_object_permission(self, request, view, obj):
        return obj.owner == request.user
```

### 6. URLs (urls.py)

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–π `DefaultRouter` –¥–ª—è ViewSets
- –ì—Ä—É–ø–ø–∏—Ä—É–π URLs –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è API (`/api/v1/`)

**–ü—Ä–∏–º–µ—Ä:**
```python
# bot_factory/urls.py
from django.contrib import admin
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from apps.bots.views import BotViewSet
from apps.knowledge.views import DocumentViewSet, TextSnippetViewSet

router = DefaultRouter()
router.register(r'bots', BotViewSet, basename='bot')
router.register(r'documents', DocumentViewSet, basename='document')
router.register(r'snippets', TextSnippetViewSet, basename='snippet')

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include(router.urls)),
    path('api/v1/auth/', include('apps.accounts.urls')),
    path('api/v1/telegram/', include('apps.telegram.urls')),
]
```

---

## üîå API Endpoints (–Ω–∞ –æ—Å–Ω–æ–≤–µ frontend —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π)

### Authentication
- `POST /api/v1/auth/register/` ‚Äî –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/auth/login/` ‚Äî –í—Ö–æ–¥ (JWT tokens)
- `POST /api/v1/auth/refresh/` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JWT token
- `POST /api/v1/auth/logout/` ‚Äî –í—ã—Ö–æ–¥
- `GET /api/v1/auth/me/` ‚Äî –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### Bots
- `GET /api/v1/bots/` ‚Äî –°–ø–∏—Å–æ–∫ –±–æ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/bots/` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
- `GET /api/v1/bots/{id}/` ‚Äî –î–µ—Ç–∞–ª–∏ –±–æ—Ç–∞
- `PUT /api/v1/bots/{id}/` ‚Äî –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `PATCH /api/v1/bots/{id}/` ‚Äî –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `DELETE /api/v1/bots/{id}/` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –±–æ—Ç–∞

### Stats (Analytics)
- `GET /api/v1/stats/?period={period}` ‚Äî Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `GET /api/v1/stats/chart/?period={period}` ‚Äî –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
- `GET /api/v1/stats/activity/` ‚Äî –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### Users (Telegram)
- `GET /api/v1/bots/{bot_id}/users/` ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞
- `POST /api/v1/users/{user_id}/status/` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Knowledge Base
- `GET /api/v1/bots/{bot_id}/documents/` ‚Äî –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `POST /api/v1/bots/{bot_id}/documents/` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (multipart/form-data)
- `DELETE /api/v1/documents/{id}/` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `GET /api/v1/bots/{bot_id}/snippets/` ‚Äî –°–ø–∏—Å–æ–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö snippets
- `POST /api/v1/snippets/` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ snippet
- `DELETE /api/v1/snippets/{id}/` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ snippet

### Chat
- `GET /api/v1/bots/{bot_id}/sessions/` ‚Äî –°–ø–∏—Å–æ–∫ —á–∞—Ç-—Å–µ—Å—Å–∏–π
- `GET /api/v1/sessions/{session_id}/messages/` ‚Äî –°–æ–æ–±—â–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏

### Subscription
- `GET /api/v1/subscription/` ‚Äî –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ –∏ usage

### Telegram Webhooks
- `POST /api/v1/telegram/webhook/{bot_token}/` ‚Äî Webhook –¥–ª—è Telegram

---

## üìä Models (–Ω–∞ –æ—Å–Ω–æ–≤–µ frontend types.ts)

### Bot Model
```python
# apps/bots/models.py
- id: UUID
- owner: FK(User)
- name: CharField(100)
- description: TextField
- status: CharField (draft/active/paused/error)
- model: CharField (gemini-2.5-flash, gpt-4, etc.)
- provider: CharField (gemini/openai/anthropic)
- temperature: FloatField (0-2)
- system_instruction: TextField
- thinking_budget: IntegerField (optional, for Gemini)
- telegram_token: CharField (optional)
- avatar: CharField (emoji or URL)
- created_at: DateTimeField
- updated_at: DateTimeField
```

### TelegramUser Model
```python
# apps/telegram/models.py
- id: UUID
- telegram_id: BigIntegerField (unique)
- bot: FK(Bot)
- username: CharField (optional)
- first_name: CharField
- last_name: CharField (optional)
- avatar_url: URLField (optional)
- status: CharField (active/blocked)
- first_seen: DateTimeField
- last_active: DateTimeField
- notes: TextField (optional)
```

### Document Model
```python
# apps/knowledge/models.py
- id: UUID
- bot: FK(Bot)
- name: CharField
- file: FileField
- type: CharField (pdf/txt/docx/md)
- size: BigIntegerField
- status: CharField (indexing/ready/error)
- upload_date: DateTimeField
```

### TextSnippet Model
```python
# apps/knowledge/models.py
- id: UUID
- bot: FK(Bot)
- title: CharField
- content: TextField
- tags: ArrayField (PostgreSQL)
- updated_at: DateTimeField
```

### ChatSession Model
```python
# apps/chat/models.py
- id: UUID
- bot: FK(Bot)
- user: FK(TelegramUser)
- created_at: DateTimeField
- updated_at: DateTimeField
- is_flagged: BooleanField
- sentiment: CharField (positive/neutral/negative)
```

### ChatMessage Model
```python
# apps/chat/models.py
- id: UUID
- session: FK(ChatSession)
- role: CharField (user/model)
- content: TextField
- timestamp: DateTimeField
- is_thinking: BooleanField (optional)
- is_flagged: BooleanField
- attachments: JSONField (optional)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Authentication
- –ò—Å–ø–æ–ª—å–∑—É–π JWT tokens (djangorestframework-simplejwt)
- Access token: –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ (15-30 –º–∏–Ω—É—Ç)
- Refresh token: –¥–ª–∏–Ω–Ω—ã–π —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ (7-30 –¥–Ω–µ–π)
- –•—Ä–∞–Ω–∏ refresh tokens –≤ HttpOnly cookies (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Permissions
- –í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`IsAuthenticated`)
- –ü—Ä–æ–≤–µ—Ä—è–π ownership —á–µ—Ä–µ–∑ –∫–∞—Å—Ç–æ–º–Ω—ã–µ permissions
- –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### Data Validation
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ serializers
- –ò—Å–ø–æ–ª—å–∑—É–π `validate()` –º–µ—Ç–æ–¥—ã
- –ü—Ä–æ–≤–µ—Ä—è–π —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

### API Security
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è frontend
- Rate limiting –¥–ª—è API endpoints (—Å–º. –Ω–∏–∂–µ)
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ sensitive –¥–∞–Ω–Ω—ã—Ö (telegram tokens)
- –ò—Å–ø–æ–ª—å–∑—É–π HTTPS –≤ production

### Rate Limiting (–í–ê–ñ–ù–û!)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `apps/accounts/views.py`:**
```python
from django.core.cache import cache
from rest_framework.exceptions import Throttled

def rate_limit(key_prefix: str, limit: int = 5, period: int = 60):
    """Rate limiting decorator using Django cache."""
    def decorator(view_func):
        @wraps(view_func)
        def wrapped_view(request, *args, **kwargs):
            # Get client IP
            x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
            ip = x_forwarded_for.split(',')[0].strip() if x_forwarded_for else request.META.get('REMOTE_ADDR')
            
            cache_key = f"ratelimit:{key_prefix}:{ip}"
            current_count = cache.get(cache_key, 0)
            
            if current_count >= limit:
                raise Throttled(detail={'message': 'Too many requests', 'retry_after': period})
            
            cache.set(cache_key, current_count + 1, period)
            return view_func(request, *args, **kwargs)
        return wrapped_view
    return decorator

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
@api_view(['POST'])
@rate_limit('login', limit=5, period=60)  # 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É
def login_view(request):
    ...
```

**–õ–∏–º–∏—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- Login: 5 –ø–æ–ø—ã—Ç–æ–∫/–º–∏–Ω—É—Ç—É –Ω–∞ IP
- Register: 3 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/—á–∞—Å –Ω–∞ IP
- Password Reset: 3 –∑–∞–ø—Ä–æ—Å–∞/—á–∞—Å –Ω–∞ IP
- API –æ–±—â–∏–π: 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Error Handling –¥–ª—è API

**–ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º:**
```python
# BAD
raise Exception(f"Gemini API error: {str(e)}")

# GOOD
logger.error(f"Gemini API error: {str(e)}", exc_info=True)
raise GeminiAPIError("Failed to generate response. Please try again.")
```

**–ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ `services/gemini.py`:**
```python
class GeminiAPIError(Exception):
    """Custom exception for Gemini API errors that hides internal details."""
    pass
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤
```python
# apps/bots/tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ test_models.py
‚îú‚îÄ‚îÄ test_serializers.py
‚îú‚îÄ‚îÄ test_views.py
‚îî‚îÄ‚îÄ test_services.py
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞
```python
import pytest
from django.contrib.auth import get_user_model
from apps.bots.models import Bot
from apps.bots.serializers import BotSerializer

User = get_user_model()

@pytest.mark.django_db
class TestBotSerializer:
    def test_create_bot(self):
        user = User.objects.create_user(email='test@example.com', password='testpass123')
        data = {
            'name': 'Test Bot',
            'model': 'gemini-2.5-flash',
            'provider': 'gemini',
        }
        serializer = BotSerializer(data=data)
        assert serializer.is_valid()
        bot = serializer.save(owner=user)
        assert bot.name == 'Test Bot'
        assert bot.owner == user
```

---

## üöÄ Deployment & Environment

### Settings Structure
```python
# bot_factory/settings/base.py ‚Äî –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
# bot_factory/settings/development.py ‚Äî –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
# bot_factory/settings/production.py ‚Äî –¥–ª—è production

# –ò—Å–ø–æ–ª—å–∑—É–π django-environ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

### Docker Compose (–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

**–ó–∞–ø—É—Å–∫ PostgreSQL + Redis:**
```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –° pgAdmin (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker-compose --profile tools up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

**–°–µ—Ä–≤–∏—Å—ã:**
- PostgreSQL 16 + pgvector: `localhost:5432`
- Redis 7: `localhost:6379`
- pgAdmin (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): `localhost:5050`

### Environment Variables (.env.example)
```bash
# Database (PostgreSQL - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è pgvector)
DB_NAME=bot_factory_db
DB_USER=postgres
DB_PASSWORD=postgres
DB_HOST=localhost
DB_PORT=5432

# –î–ª—è SQLite (pgvector –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç):
# DB_NAME=db.sqlite3
# DB_ENGINE=sqlite3

# Django
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# API Keys
GEMINI_API_KEY=your-gemini-api-key
TELEGRAM_BOT_TOKEN=your-telegram-bot-token

# Redis (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ rate limiting)
REDIS_URL=redis://localhost:6379/0

# CORS
CORS_ALLOWED_ORIGINS=http://localhost:3000
```

### Cache Configuration

**base.py:**
```python
# –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –¥–ª—è development
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.locmem.LocMemCache',
        'LOCATION': 'unique-snowflake',
    }
}

# Redis –¥–ª—è production
if REDIS_URL and not DEBUG:
    CACHES = {
        'default': {
            'BACKEND': 'django.core.cache.backends.redis.RedisCache',
            'LOCATION': REDIS_URL,
        }
    }
```

---

## üìù Naming Conventions

### Python
- **–ö–ª–∞—Å—Å—ã:** PascalCase (`BotViewSet`, `BotService`)
- **–§—É–Ω–∫—Ü–∏–∏/–º–µ—Ç–æ–¥—ã:** snake_case (`create_bot`, `get_queryset`)
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:** UPPER_SNAKE_CASE (`MAX_BOT_NAME_LENGTH`)
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã:** —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `_` (`_internal_method`)

### Django
- **Models:** PascalCase (`Bot`, `TelegramUser`)
- **ViewSets:** PascalCase + ViewSet (`BotViewSet`)
- **Serializers:** PascalCase + Serializer (`BotSerializer`)
- **URLs:** kebab-case –≤ URL (`/api/v1/bots/`), snake_case –≤ view names

### Files
- `models.py`, `views.py`, `serializers.py`, `urls.py` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django –∏–º–µ–Ω–∞
- `services.py` ‚Äî –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- `permissions.py` ‚Äî –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö permissions
- `utils.py` ‚Äî –¥–ª—è —É—Ç–∏–ª–∏—Ç

---

## üîÑ API Response Format

### Success Response
```json
{
  "id": "uuid-string",
  "name": "Bot Name",
  "status": "active",
  ...
}
```

### Error Response
```json
{
  "error": {
    "message": "Error message",
    "code": "ERROR_CODE",
    "status": 400,
    "details": {
      "field_name": ["Error message for field"]
    }
  }
}
```

### Pagination
```json
{
  "count": 100,
  "next": "http://api.example.com/bots/?page=2",
  "previous": null,
  "results": [...]
}
```

---

## üéØ Best Practices

### 1. Code Quality
- –ò—Å–ø–æ–ª—å–∑—É–π `black` –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π `flake8` –∏–ª–∏ `ruff` –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞
- –ü–∏—à–∏ docstrings –¥–ª—è –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π type hints –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

### 2. Performance
- –ò—Å–ø–æ–ª—å–∑—É–π `select_related()` –∏ `prefetch_related()` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
- –ö—ç—à–∏—Ä—É–π —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

### 3. Error Handling
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞—Å—Ç–æ–º–Ω—ã–µ exceptions (`core/exceptions.py`)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π –æ—à–∏–±–∫–∏ –≤ views –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä—É–π –æ—à–∏–±–∫–∏ –¥–ª—è debugging

### 4. Documentation
- –ò—Å–ø–æ–ª—å–∑—É–π DRF Schema –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü–∏—à–∏ README –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

---

## üîó Integration Points

### Frontend Integration
- **Base URL:** `http://localhost:8000/api/v1/`
- **CORS:** –†–∞–∑—Ä–µ—à–µ–Ω `http://localhost:3000` (frontend dev server)
- **Authentication:** JWT tokens –≤ Authorization header

### Telegram Integration
- **Webhook URL:** `/api/v1/telegram/webhook/{bot_token}/`
- **Handler:** Async –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Celery (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

### Google Gemini Integration
- **Service:** `services/gemini.py`
- **Rate Limiting:** –£—á–∏—Ç—ã–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã API
- **Error Handling:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ API gracefully

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ü—Ä–∞–≤–∏–ª–∞

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏
- –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–æ–¥–µ–ª–µ–π
- –ü—Ä–æ–≤–µ—Ä—è–π –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
- –ò—Å–ø–æ–ª—å–∑—É–π `--name` –¥–ª—è –ø–æ–Ω—è—Ç–Ω—ã—Ö –∏–º–µ–Ω –º–∏–≥—Ä–∞—Ü–∏–π

### 2. –ö–æ–º–º–∏—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π conventional commits (feat:, fix:, refactor:, etc.)
- –ü–∏—à–∏ –ø–æ–Ω—è—Ç–Ω—ã–µ commit messages

### 3. Code Reviews
- –ü—Ä–æ–≤–µ—Ä—è–π security issues
- –ü—Ä–æ–≤–µ—Ä—è–π performance implications
- –ü—Ä–æ–≤–µ—Ä—è–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É —Å frontend

---

---

## üîÑ Async Views (Django 4.1+)

### –ü–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π

**–ò—Å–ø–æ–ª—å–∑—É–π async views –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤:**
```python
from django.http import JsonResponse
from asgiref.sync import sync_to_async

# Async view
async def generate_response_view(request):
    """Async view for Gemini API calls."""
    data = json.loads(request.body)
    
    # Sync to async –¥–ª—è Django ORM
    bot = await sync_to_async(Bot.objects.get)(id=data['bot_id'])
    
    # Async HTTP –≤—ã–∑–æ–≤
    async with aiohttp.ClientSession() as session:
        response = await session.post(GEMINI_URL, json=payload)
        result = await response.json()
    
    return JsonResponse(result)

# urls.py
path('api/v1/generate/', generate_response_view),
```

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å async views:**
- –í—ã–∑–æ–≤—ã –≤–Ω–µ—à–Ω–∏—Ö API (Gemini, Telegram)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏
- –î–æ–ª–≥–∏–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –ü—Ä–æ—Å—Ç—ã–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (Django ORM –∏ —Ç–∞–∫ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

---

**–í–µ—Ä—Å–∏—è:** 1.1
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-25
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:** –î–æ–±–∞–≤–ª–µ–Ω rate limiting, async views, Docker Compose

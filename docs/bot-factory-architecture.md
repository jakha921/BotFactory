# ü§ñ BotFactory SaaS ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**BotFactory** ‚Äî SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è AI-–±–æ—Ç–æ–≤ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç —Ç–æ–∫–µ–Ω –±–æ—Ç–∞, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç AI-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ–º–∞–Ω–¥—ã –∏ —Ñ–æ—Ä–º—ã ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –±—ç–∫–µ–Ω–¥.

---

## üèóÔ∏è –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                              –ö–õ–ò–ï–ù–¢–´                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Dashboard (React/Next.js)  ‚îÇ  Landing Page  ‚îÇ  API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           API GATEWAY (FastAPI)                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Auth  ‚îÇ  Rate Limiting  ‚îÇ  Tenant Resolution  ‚îÇ  Request Routing           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚ñº                 ‚ñº                 ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ   Bot Manager   ‚îÇ ‚îÇ  AI Processor   ‚îÇ ‚îÇ  Form Builder   ‚îÇ
          ‚îÇ     Service     ‚îÇ ‚îÇ    Service      ‚îÇ ‚îÇ    Service      ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ                 ‚îÇ                 ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        MESSAGE BROKER (Redis/RabbitMQ)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Incoming Messages Queue  ‚îÇ  AI Processing Queue  ‚îÇ  Outgoing Messages      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚ñº                 ‚ñº                 ‚ñº
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ    Telegram     ‚îÇ ‚îÇ    WhatsApp     ‚îÇ ‚îÇ    Discord      ‚îÇ
          ‚îÇ    Workers      ‚îÇ ‚îÇ    Workers      ‚îÇ ‚îÇ    Workers      ‚îÇ
          ‚îÇ   (Aiogram)     ‚îÇ ‚îÇ    (Future)     ‚îÇ ‚îÇ    (Future)     ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           DATA LAYER                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  PostgreSQL (Main DB)  ‚îÇ  Redis (Cache/Sessions)  ‚îÇ  S3 (Files/Media)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
botfactory/
‚îú‚îÄ‚îÄ üìÅ api/                          # FastAPI Backend
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ core/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py          # JWT, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dependencies.py      # Dependency injection
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/               # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tenant.py            # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏/–¢–∞—Ä–∏—Ñ—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ form.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conversation.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ schemas/              # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ form.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ v1/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bots.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhooks.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ router.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot_manager.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_processor.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ AI
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ form_processor.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ analytics.py
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ workers/                  # Celery/Background tasks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegram_worker.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai_worker.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ migrations/               # Alembic
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îÇ
‚îú‚îÄ‚îÄ üìÅ bot_gateway/                  # Telegram Gateway
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_handler.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_handler.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callback_handler.py
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ middlewares/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tenant_middleware.py     # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ—Ç–∞/—Ç–µ–Ω–∞–Ω—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rate_limit.py
‚îÇ   ‚îú‚îÄ‚îÄ dispatcher.py
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ
‚îú‚îÄ‚îÄ üìÅ dashboard/                    # Frontend (Next.js)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ (auth)/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bots/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analytics/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ components/
‚îÇ       ‚îú‚îÄ‚îÄ BotCard.tsx
‚îÇ       ‚îú‚îÄ‚îÄ CommandBuilder.tsx
‚îÇ       ‚îú‚îÄ‚îÄ FormBuilder.tsx
‚îÇ       ‚îî‚îÄ‚îÄ AIPromptEditor.tsx
‚îÇ
‚îú‚îÄ‚îÄ üìÅ shared/                       # –û–±—â–∏–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ types/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ utils/
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ docker-compose.prod.yml
‚îî‚îÄ‚îÄ README.md
```

---

## üóÑÔ∏è –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

```python
# models/tenant.py
class Tenant(Base):
    """–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è/–ö–æ–º–ø–∞–Ω–∏—è ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –±–æ—Ç–æ–≤"""
    __tablename__ = "tenants"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    name = Column(String(255), nullable=False)
    slug = Column(String(100), unique=True)
    
    # –¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω
    plan = Column(Enum(PlanType), default=PlanType.FREE)
    plan_expires_at = Column(DateTime)
    
    # –õ–∏–º–∏—Ç—ã
    max_bots = Column(Integer, default=1)
    max_messages_per_month = Column(Integer, default=1000)
    messages_used = Column(Integer, default=0)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ AI
    openai_api_key = Column(String, nullable=True)  # Encrypted
    use_platform_key = Column(Boolean, default=True)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # Relations
    users = relationship("User", back_populates="tenant")
    bots = relationship("Bot", back_populates="tenant")


# models/bot.py
class Bot(Base):
    """Telegram –±–æ—Ç"""
    __tablename__ = "bots"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    tenant_id = Column(UUID, ForeignKey("tenants.id"), nullable=False)
    
    # Telegram –¥–∞–Ω–Ω—ã–µ
    token = Column(String, nullable=False)  # Encrypted
    username = Column(String(100))
    telegram_id = Column(BigInteger, unique=True)
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    name = Column(String(255), nullable=False)
    description = Column(Text)
    is_active = Column(Boolean, default=True)
    
    # AI –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ai_enabled = Column(Boolean, default=True)
    system_prompt = Column(Text)  # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è AI
    ai_model = Column(String(50), default="gpt-4o-mini")
    temperature = Column(Float, default=0.7)
    max_tokens = Column(Integer, default=1000)
    
    # –ü–æ–≤–µ–¥–µ–Ω–∏–µ
    welcome_message = Column(Text)
    fallback_message = Column(Text)  # –ö–æ–≥–¥–∞ AI –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å
    
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # Relations
    tenant = relationship("Tenant", back_populates="bots")
    commands = relationship("Command", back_populates="bot")
    forms = relationship("Form", back_populates="bot")
    conversations = relationship("Conversation", back_populates="bot")


# models/command.py
class Command(Base):
    """–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä /start, /help)"""
    __tablename__ = "commands"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    bot_id = Column(UUID, ForeignKey("bots.id"), nullable=False)
    
    # –ö–æ–º–∞–Ω–¥–∞
    name = Column(String(100), nullable=False)  # –±–µ–∑ /
    description = Column(String(255))
    
    # –¢–∏–ø –æ—Ç–≤–µ—Ç–∞
    response_type = Column(Enum(ResponseType))  # TEXT, AI, FORM, MENU
    
    # –ö–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
    text_response = Column(Text)  # –î–ª—è TEXT
    ai_prompt_override = Column(Text)  # –î–ª—è AI - –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–º–ø—Ç
    form_id = Column(UUID, ForeignKey("forms.id"))  # –î–ª—è FORM
    menu_config = Column(JSON)  # –î–ª—è MENU - inline –∫–Ω–æ–ø–∫–∏
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
    is_active = Column(Boolean, default=True)
    priority = Column(Integer, default=0)  # –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    
    # Relations
    bot = relationship("Bot", back_populates="commands")
    form = relationship("Form")


# models/form.py
class Form(Base):
    """–§–æ—Ä–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö"""
    __tablename__ = "forms"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    bot_id = Column(UUID, ForeignKey("bots.id"), nullable=False)
    
    name = Column(String(255), nullable=False)
    description = Column(Text)
    
    # –ü–æ–ª—è —Ñ–æ—Ä–º—ã
    fields = Column(JSON)  # [{name, type, label, required, options, validation}]
    
    # –î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
    on_complete_action = Column(Enum(FormAction))  # NOTIFY, SAVE, WEBHOOK, AI
    webhook_url = Column(String)
    notification_chat_id = Column(BigInteger)
    completion_message = Column(Text)
    
    is_active = Column(Boolean, default=True)
    
    # Relations
    bot = relationship("Bot", back_populates="forms")
    submissions = relationship("FormSubmission", back_populates="form")


# models/conversation.py
class Conversation(Base):
    """–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤"""
    __tablename__ = "conversations"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    bot_id = Column(UUID, ForeignKey("bots.id"), nullable=False)
    
    # Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    telegram_user_id = Column(BigInteger, nullable=False)
    telegram_username = Column(String(100))
    telegram_first_name = Column(String(255))
    
    # –°–æ—Å—Ç–æ—è–Ω–∏–µ
    state = Column(String(100))  # –î–ª—è FSM (–Ω–∞–ø—Ä–∏–º–µ—Ä: filling_form:form_id)
    context = Column(JSON)  # –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è AI
    
    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    started_at = Column(DateTime, default=datetime.utcnow)
    last_message_at = Column(DateTime)
    messages_count = Column(Integer, default=0)
    
    # Relations
    bot = relationship("Bot", back_populates="conversations")
    messages = relationship("Message", back_populates="conversation")


# models/message.py
class Message(Base):
    """–°–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ"""
    __tablename__ = "messages"
    
    id = Column(UUID, primary_key=True, default=uuid4)
    conversation_id = Column(UUID, ForeignKey("conversations.id"), nullable=False)
    
    # –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    direction = Column(Enum(MessageDirection))  # INBOUND, OUTBOUND
    
    # –ö–æ–Ω—Ç–µ–Ω—Ç
    content = Column(Text, nullable=False)
    message_type = Column(Enum(MessageType))  # TEXT, PHOTO, DOCUMENT, etc.
    
    # Telegram –¥–∞–Ω–Ω—ã–µ
    telegram_message_id = Column(BigInteger)
    
    # AI –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    ai_processed = Column(Boolean, default=False)
    tokens_used = Column(Integer)
    processing_time_ms = Column(Integer)
    
    created_at = Column(DateTime, default=datetime.utcnow)
    
    # Relations
    conversation = relationship("Conversation", back_populates="messages")
```

### Enums

```python
# models/enums.py
from enum import Enum

class PlanType(str, Enum):
    FREE = "free"           # 1 –±–æ—Ç, 1000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å
    STARTER = "starter"     # 3 –±–æ—Ç–∞, 10000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å
    PRO = "pro"             # 10 –±–æ—Ç–æ–≤, 50000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å
    ENTERPRISE = "enterprise"  # Unlimited

class ResponseType(str, Enum):
    TEXT = "text"           # –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç
    AI = "ai"               # AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
    FORM = "form"           # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É
    MENU = "menu"           # –ü–æ–∫–∞–∑–∞—Ç—å inline –∫–Ω–æ–ø–∫–∏
    WEBHOOK = "webhook"     # –í—ã–∑–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π API

class FormFieldType(str, Enum):
    TEXT = "text"
    NUMBER = "number"
    EMAIL = "email"
    PHONE = "phone"
    DATE = "date"
    SELECT = "select"       # –í—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞
    MULTISELECT = "multiselect"
    PHOTO = "photo"
    LOCATION = "location"

class FormAction(str, Enum):
    SAVE = "save"           # –¢–æ–ª—å–∫–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
    NOTIFY = "notify"       # –£–≤–µ–¥–æ–º–∏—Ç—å –∞–¥–º–∏–Ω–∞
    WEBHOOK = "webhook"     # –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ webhook
    AI = "ai"               # –û–±—Ä–∞–±–æ—Ç–∞—Ç—å AI

class MessageDirection(str, Enum):
    INBOUND = "inbound"     # –û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    OUTBOUND = "outbound"   # –û—Ç –±–æ—Ç–∞
```

---

## üîÑ –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    INCOMING MESSAGE FLOW                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. Telegram Update
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Bot Gateway    ‚îÇ ‚Üê –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –±–æ—Ç–æ–≤
‚îÇ  (Webhook/Poll) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tenant Resolver ‚îÇ ‚Üê –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞–∫–æ–π –±–æ—Ç –ø–æ telegram_id
‚îÇ   Middleware    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Rate Limiter   ‚îÇ ‚Üê –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã —Ç–µ–Ω–∞–Ω—Ç–∞
‚îÇ   Middleware    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Command Router  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ Command Handler ‚îÇ ‚Üê –ï—Å–ª–∏ —ç—Ç–æ /–∫–æ–º–∞–Ω–¥–∞
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ (–µ—Å–ª–∏ –Ω–µ –∫–æ–º–∞–Ω–¥–∞)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  State Router   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  Form Handler   ‚îÇ ‚Üê –ï—Å–ª–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ñ–æ—Ä–º—ã
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îÇ (–µ—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AI Message      ‚îÇ
‚îÇ Processor       ‚îÇ
‚îÇ                 ‚îÇ
‚îÇ 1. Load context ‚îÇ
‚îÇ 2. Build prompt ‚îÇ
‚îÇ 3. Call LLM     ‚îÇ
‚îÇ 4. Save history ‚îÇ
‚îÇ 5. Send reply   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß† AI Processing Service

```python
# services/ai_processor.py
from openai import AsyncOpenAI
from typing import Optional

class AIProcessor:
    def __init__(self, settings: Settings):
        self.default_client = AsyncOpenAI(api_key=settings.OPENAI_API_KEY)
    
    async def process_message(
        self,
        bot: Bot,
        conversation: Conversation,
        user_message: str,
        tenant: Tenant
    ) -> str:
        # 1. –ü–æ–ª—É—á–∞–µ–º –∫–ª–∏–µ–Ω—Ç (—Å–≤–æ–π –∫–ª—é—á —Ç–µ–Ω–∞–Ω—Ç–∞ –∏–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π)
        client = self._get_client(tenant)
        
        # 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N —Å–æ–æ–±—â–µ–Ω–∏–π
        history = await self._load_conversation_history(
            conversation.id, 
            limit=10
        )
        
        # 3. –°–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç
        messages = self._build_messages(
            system_prompt=bot.system_prompt,
            history=history,
            user_message=user_message
        )
        
        # 4. –í—ã–∑—ã–≤–∞–µ–º LLM
        response = await client.chat.completions.create(
            model=bot.ai_model,
            messages=messages,
            temperature=bot.temperature,
            max_tokens=bot.max_tokens
        )
        
        # 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –º–µ—Ç—Ä–∏–∫–∏
        await self._save_messages(
            conversation_id=conversation.id,
            user_message=user_message,
            ai_response=response.choices[0].message.content,
            tokens_used=response.usage.total_tokens
        )
        
        # 6. –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–Ω–∞–Ω—Ç–∞
        await self._increment_usage(tenant.id)
        
        return response.choices[0].message.content
    
    def _build_messages(
        self, 
        system_prompt: str, 
        history: list[Message],
        user_message: str
    ) -> list[dict]:
        messages = []
        
        # System prompt
        if system_prompt:
            messages.append({
                "role": "system",
                "content": system_prompt
            })
        
        # History
        for msg in history:
            role = "user" if msg.direction == MessageDirection.INBOUND else "assistant"
            messages.append({
                "role": role,
                "content": msg.content
            })
        
        # Current message
        messages.append({
            "role": "user",
            "content": user_message
        })
        
        return messages
```

---

## üì± Telegram Gateway (Multi-bot support)

```python
# bot_gateway/main.py
from aiogram import Bot, Dispatcher
from aiogram.webhook.aiohttp_server import SimpleRequestHandler
from aiohttp import web
import asyncio

class BotGateway:
    """
    –ï–¥–∏–Ω—ã–π gateway –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö Telegram –±–æ—Ç–æ–≤.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç webhook —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –±–æ—Ç–∞.
    """
    
    def __init__(self, settings: Settings, db: Database):
        self.settings = settings
        self.db = db
        self.bots: dict[int, Bot] = {}  # telegram_id -> Bot instance
        self.dp = Dispatcher()
        
        # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º handlers
        self._setup_handlers()
    
    async def start(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –±–æ—Ç—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ–º gateway"""
        
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –±–æ—Ç—ã –∏–∑ –ë–î
        active_bots = await self.db.get_active_bots()
        
        for bot_config in active_bots:
            await self._register_bot(bot_config)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º webhook server
        app = web.Application()
        
        # –ï–¥–∏–Ω—ã–π endpoint –¥–ª—è –≤—Å–µ—Ö –±–æ—Ç–æ–≤
        app.router.add_post(
            "/webhook/{bot_token}", 
            self._handle_webhook
        )
        
        runner = web.AppRunner(app)
        await runner.setup()
        site = web.TCPSite(runner, "0.0.0.0", self.settings.WEBHOOK_PORT)
        await site.start()
    
    async def _register_bot(self, bot_config: BotModel):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –±–æ—Ç–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook"""
        bot = Bot(token=bot_config.token)
        bot_info = await bot.get_me()
        
        self.bots[bot_info.id] = bot
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook
        webhook_url = f"{self.settings.WEBHOOK_BASE_URL}/webhook/{bot_config.token}"
        await bot.set_webhook(webhook_url)
        
        print(f"‚úÖ Bot @{bot_info.username} registered")
    
    async def _handle_webhook(self, request: web.Request):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º webhook –æ—Ç –ª—é–±–æ–≥–æ –±–æ—Ç–∞"""
        bot_token = request.match_info["bot_token"]
        
        # –ù–∞—Ö–æ–¥–∏–º –±–æ—Ç–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
        bot = self._get_bot_by_token(bot_token)
        if not bot:
            return web.Response(status=404)
        
        # –ü–∞—Ä—Å–∏–º update
        data = await request.json()
        update = types.Update(**data)
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ dispatcher
        await self.dp.feed_update(bot, update)
        
        return web.Response()
    
    def _setup_handlers(self):
        """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π"""
        
        @self.dp.message(Command("start"))
        async def handle_start(message: types.Message, bot: Bot):
            bot_config = await self._get_bot_config(bot)
            
            if bot_config.welcome_message:
                await message.answer(bot_config.welcome_message)
        
        @self.dp.message()
        async def handle_message(message: types.Message, bot: Bot):
            """–û—Å–Ω–æ–≤–Ω–æ–π handler –¥–ª—è –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
            
            # –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥ –±–æ—Ç–∞
            bot_config = await self._get_bot_config(bot)
            tenant = await self._get_tenant(bot_config.tenant_id)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç—ã
            if not await self._check_limits(tenant):
                await message.answer(
                    "‚ö†Ô∏è –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. "
                    "–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤–ª–∞–¥–µ–ª—å—Ü—É –±–æ—Ç–∞."
                )
                return
            
            # –ü–æ–ª—É—á–∞–µ–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º conversation
            conversation = await self._get_or_create_conversation(
                bot_config.id,
                message.from_user
            )
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã)
            if conversation.state:
                await self._handle_state(
                    conversation, 
                    message, 
                    bot_config
                )
                return
            
            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º AI
            if bot_config.ai_enabled:
                response = await self.ai_processor.process_message(
                    bot=bot_config,
                    conversation=conversation,
                    user_message=message.text,
                    tenant=tenant
                )
                await message.answer(response)
            else:
                # Fallback –µ—Å–ª–∏ AI –≤—ã–∫–ª—é—á–µ–Ω
                if bot_config.fallback_message:
                    await message.answer(bot_config.fallback_message)
```

---

## üé® Dashboard API Endpoints

```python
# api/v1/bots.py
from fastapi import APIRouter, Depends, HTTPException
from typing import List

router = APIRouter(prefix="/bots", tags=["bots"])

@router.get("/", response_model=List[BotResponse])
async def list_bots(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±–æ—Ç—ã —Ç–µ–Ω–∞–Ω—Ç–∞"""
    bots = await bot_service.get_bots_by_tenant(
        db, 
        current_user.tenant_id
    )
    return bots


@router.post("/", response_model=BotResponse)
async def create_bot(
    bot_data: BotCreate,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –±–æ—Ç–æ–≤
    tenant = await tenant_service.get_tenant(db, current_user.tenant_id)
    bots_count = await bot_service.count_bots(db, tenant.id)
    
    if bots_count >= tenant.max_bots:
        raise HTTPException(
            status_code=403,
            detail=f"–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –±–æ—Ç–æ–≤ ({tenant.max_bots}). –û–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ."
        )
    
    # –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω Telegram
    try:
        bot_info = await telegram_service.validate_token(bot_data.token)
    except Exception:
        raise HTTPException(
            status_code=400,
            detail="–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞"
        )
    
    # –°–æ–∑–¥–∞—ë–º –±–æ—Ç–∞
    bot = await bot_service.create_bot(
        db,
        tenant_id=tenant.id,
        token=bot_data.token,
        telegram_id=bot_info.id,
        username=bot_info.username,
        name=bot_data.name,
        system_prompt=bot_data.system_prompt
    )
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º webhook
    await bot_gateway.register_bot(bot)
    
    return bot


@router.patch("/{bot_id}", response_model=BotResponse)
async def update_bot(
    bot_id: UUID,
    bot_data: BotUpdate,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞"""
    bot = await bot_service.get_bot(db, bot_id, current_user.tenant_id)
    
    if not bot:
        raise HTTPException(status_code=404, detail="–ë–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    updated_bot = await bot_service.update_bot(db, bot, bot_data)
    return updated_bot


@router.post("/{bot_id}/test-prompt")
async def test_prompt(
    bot_id: UUID,
    test_data: TestPromptRequest,
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db)
):
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–æ—Ç–∞"""
    bot = await bot_service.get_bot(db, bot_id, current_user.tenant_id)
    
    response = await ai_processor.test_prompt(
        system_prompt=test_data.system_prompt or bot.system_prompt,
        user_message=test_data.message,
        model=bot.ai_model
    )
    
    return {"response": response}
```

---

## üìä Form Builder & Processing

```python
# services/form_processor.py

class FormProcessor:
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º"""
    
    async def start_form(
        self, 
        form: Form, 
        conversation: Conversation,
        bot: Bot
    ) -> str:
        """–ù–∞—á–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã"""
        
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        conversation.state = f"form:{form.id}:0"
        conversation.context = {
            "form_id": str(form.id),
            "current_field": 0,
            "answers": {}
        }
        await self.db.commit()
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
        first_field = form.fields[0]
        return self._format_question(first_field)
    
    async def process_answer(
        self,
        conversation: Conversation,
        message: str,
        bot_instance: Bot
    ) -> tuple[str, bool]:
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å —Ñ–æ—Ä–º—ã.
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–æ—Ç–≤–µ—Ç, –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ª–∏ —Ñ–æ—Ä–º–∞)
        """
        
        context = conversation.context
        form = await self.db.get(Form, context["form_id"])
        current_idx = context["current_field"]
        current_field = form.fields[current_idx]
        
        # –í–∞–ª–∏–¥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
        is_valid, error = self._validate_answer(current_field, message)
        
        if not is_valid:
            return error, False
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
        context["answers"][current_field["name"]] = message
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã
        if current_idx + 1 >= len(form.fields):
            # –§–æ—Ä–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
            await self._complete_form(form, conversation, context["answers"])
            
            conversation.state = None
            conversation.context = {}
            await self.db.commit()
            
            return form.completion_message or "‚úÖ –°–ø–∞—Å–∏–±–æ! –§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞.", True
        
        # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
        context["current_field"] = current_idx + 1
        await self.db.commit()
        
        next_field = form.fields[current_idx + 1]
        return self._format_question(next_field), False
    
    def _format_question(self, field: dict) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤–æ–ø—Ä–æ—Å"""
        question = field["label"]
        
        if field["type"] == "select":
            options = "\n".join(
                f"{i+1}. {opt}" 
                for i, opt in enumerate(field["options"])
            )
            question += f"\n\n{options}"
        
        if not field.get("required", True):
            question += "\n\n(–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)"
        
        return question
    
    def _validate_answer(self, field: dict, answer: str) -> tuple[bool, str]:
        """–í–∞–ª–∏–¥–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç"""
        
        # –ü—Ä–æ–ø—É—Å–∫ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—è
        if answer == "-" and not field.get("required", True):
            return True, ""
        
        field_type = field["type"]
        
        if field_type == "email":
            if "@" not in answer:
                return False, "‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email"
        
        elif field_type == "phone":
            if not answer.replace("+", "").replace(" ", "").isdigit():
                return False, "‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
        
        elif field_type == "number":
            try:
                float(answer)
            except ValueError:
                return False, "‚ùå –í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ"
        
        elif field_type == "select":
            options = field["options"]
            if answer not in options and not answer.isdigit():
                return False, f"‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: {', '.join(options)}"
        
        return True, ""
    
    async def _complete_form(
        self, 
        form: Form, 
        conversation: Conversation,
        answers: dict
    ):
        """–î–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã"""
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º submission
        submission = FormSubmission(
            form_id=form.id,
            conversation_id=conversation.id,
            answers=answers
        )
        self.db.add(submission)
        
        # –í—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
        if form.on_complete_action == FormAction.NOTIFY:
            await self._notify_admin(form, answers)
        
        elif form.on_complete_action == FormAction.WEBHOOK:
            await self._send_webhook(form.webhook_url, answers)
        
        elif form.on_complete_action == FormAction.AI:
            # AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã
            pass
```

---

## üí∞ –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã

```python
# services/billing.py

PLANS = {
    PlanType.FREE: {
        "name": "Free",
        "price": 0,
        "max_bots": 1,
        "max_messages": 1000,
        "features": [
            "1 –±–æ—Ç",
            "1,000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å",
            "–ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã",
            "–ò—Å—Ç–æ—Ä–∏—è 7 –¥–Ω–µ–π"
        ]
    },
    PlanType.STARTER: {
        "name": "Starter",
        "price": 19,
        "max_bots": 3,
        "max_messages": 10000,
        "features": [
            "3 –±–æ—Ç–∞",
            "10,000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å",
            "–§–æ—Ä–º—ã",
            "Webhooks",
            "–ò—Å—Ç–æ—Ä–∏—è 30 –¥–Ω–µ–π"
        ]
    },
    PlanType.PRO: {
        "name": "Pro",
        "price": 49,
        "max_bots": 10,
        "max_messages": 50000,
        "features": [
            "10 –±–æ—Ç–æ–≤",
            "50,000 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–µ—Å",
            "–°–≤–æ–π API –∫–ª—é—á OpenAI",
            "–ê–Ω–∞–ª–∏—Ç–∏–∫–∞",
            "Priority support"
        ]
    },
    PlanType.ENTERPRISE: {
        "name": "Enterprise",
        "price": None,  # Custom
        "max_bots": -1,  # Unlimited
        "max_messages": -1,
        "features": [
            "–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –±–æ—Ç—ã",
            "–ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è",
            "Dedicated support",
            "Custom integrations",
            "SLA"
        ]
    }
}
```

---

## üöÄ Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```yaml
# docker-compose.yml
version: '3.8'

services:
  # PostgreSQL
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: botfactory
      POSTGRES_USER: botfactory
      POSTGRES_PASSWORD: secret
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  # API
  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: postgresql+asyncpg://botfactory:secret@postgres:5432/botfactory
      REDIS_URL: redis://redis:6379
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      SECRET_KEY: ${SECRET_KEY}
    ports:
      - "8000:8000"
    depends_on:
      - postgres
      - redis
    volumes:
      - ./api:/app

  # Bot Gateway
  bot_gateway:
    build:
      context: ./bot_gateway
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: postgresql+asyncpg://botfactory:secret@postgres:5432/botfactory
      REDIS_URL: redis://redis:6379
      WEBHOOK_BASE_URL: ${WEBHOOK_BASE_URL}
      WEBHOOK_PORT: 8080
    ports:
      - "8080:8080"
    depends_on:
      - postgres
      - redis
      - api

  # Dashboard (Next.js)
  dashboard:
    build:
      context: ./dashboard
      dockerfile: Dockerfile
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8000
    ports:
      - "3000:3000"
    volumes:
      - ./dashboard:/app
      - /app/node_modules

volumes:
  postgres_data:
  redis_data:
```

---

## üìã Roadmap

### Phase 1: MVP (4-6 –Ω–µ–¥–µ–ª—å)
- [ ] –ë–∞–∑–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT)
- [ ] CRUD –¥–ª—è –±–æ—Ç–æ–≤
- [ ] AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –ö–æ–º–∞–Ω–¥—ã (/start, /help)
- [ ] –ü—Ä–æ—Å—Ç–æ–π dashboard

### Phase 2: Core Features (4-6 –Ω–µ–¥–µ–ª—å)
- [ ] Form Builder
- [ ] Inline –∫–Ω–æ–ø–∫–∏ –∏ –º–µ–Ω—é
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- [ ] –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### Phase 3: Growth (4-6 –Ω–µ–¥–µ–ª—å)
- [ ] –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –±–∏–ª–ª–∏–Ω–≥
- [ ] Webhooks
- [ ] –°–≤–æ–π API –∫–ª—é—á OpenAI
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### Phase 4: Scale (ongoing)
- [ ] WhatsApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Discord –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] AI function calling
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤** ‚Äî –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –±–æ—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ (Fernet)
2. **Rate Limiting** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS
3. **Tenant Isolation** ‚Äî —Å—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏
4. **JWT —Å refresh tokens** ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
5. **Input validation** ‚Äî Pydantic –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
